PC and PC Expressions

PC Expr  e_pc    ::= low âŸ¨ cÌ…  âŸ©
PC       pc      ::= low âŸ¨ cÌ…â‚™ âŸ©

Shorthands for PC expressions:

     âŠ¢ cÌ… : low â‡’ g   e_pc=lowâŸ¨cÌ…âŸ©
  ----------------------------------
           âŠ¢ e_pc : g

       cÌ…â‚ â€”â†’ cÌ…â‚‚   e_pcâ‚=lowâŸ¨cÌ…â‚âŸ©  e_pcâ‚‚=lowâŸ¨cÌ…â‚‚âŸ©
  ---------------------------------------------------
              e_pcâ‚ â€”â†’ e_pcâ‚‚

stamp : (cÌ…â‚™ : âŠ¢ â„“â‚ â‡’ g) â†’ (â„“â‚‚ : StaticLabel) â†’ âŠ¢ â„“â‚ â‡’ g â‹Ìƒ â„“â‚‚
stamp cÌ…â‚™ low = cÌ…â‚™
stamp ID(low)                 high = ID(low) â¨¾ â†‘
stamp ID(high)                high = ID(high)
stamp (ID(low) â¨¾ â†‘)          high = ID(low) â¨¾ â†‘
stamp (ID(low) â¨¾ low !)       high = ID(low) â¨¾ â†‘ â¨¾ high !
stamp (ID(high) â¨¾ high !)     high = ID(high) â¨¾ high !
stamp (ID(low) â¨¾ â†‘ ; high !) high = ID(low) â¨¾ â†‘ ; high !

stamp : PC â†’ StaticLabel â†’ PC
stamp (low âŸ¨ cÌ…â‚™ âŸ©) â„“ = low âŸ¨ stamp cÌ…â‚™ â„“ âŸ©

pc_err : BlameLabel â†’ PCExpr
pc_err p = low âŸ¨ âŠ¥áµ– âŸ©

_âŸ¨_âŸ© : PCExpr â†’ (c : âŠ¢ gâ‚ â‡’ gâ‚‚) â†’ PCExpr
(low âŸ¨ cÌ… âŸ©) âŸ¨ c âŸ© = low âŸ¨ cÌ… â¨¾ c âŸ©

_âŸ¨_âŸ© : PCExpr â†’ (cÌ… : âŠ¢ gâ‚ â‡’ gâ‚‚) â†’ PCExpr
(low âŸ¨ cÌ…â‚ âŸ©) âŸ¨ cÌ…â‚‚ âŸ© = low âŸ¨ cÌ…â‚ â¨Ÿ cÌ…â‚‚ âŸ©


Expressions
M ::= app L M A B â„“ | app! L M A B g
    | if  L A â„“ M N | if!  L A g M N
    | let M N | refâŸ¦ â„“ âŸ§ M | ref?âŸ¦ â„“ âŸ§ M p | ! M
    | assign  L M T â„“Ì‚ â„“ | assign? L M T p
    | â–¡ âŸ¨ c âŸ© | â¦ƒ pc â¦„ M âŸª â„“ âŸ« | { cÌ… } M âŸª â„“ âŸ« | blame p

Raw values   Váµ£, Wáµ£ ::= k  | Æ› N | addr n â„“
Values       V, W   ::= Váµ£ | Váµ£ âŸ¨ cáµ¢ âŸ©


Frames
F ::= app  â–¡ M A B â„“ | app  V â–¡ A B â„“
    | app! â–¡ M A B g | app! V â–¡ A B g
    | if   â–¡ A â„“ M N | if!  â–¡ A g M N
    | let â–¡ N | refâŸ¦ â„“ âŸ§ â–¡ | ref?âŸ¦ â„“ âŸ§ â–¡ p | ! â–¡
    | assign  â–¡ M T â„“Ì‚ â„“ | assign  V â–¡ T â„“Ì‚ â„“
    | assign? â–¡ M T p   | assign? V â–¡ T p
    | â–¡ âŸ¨ c âŸ©


         M âˆ£ Î¼ âˆ£ pc â€”â†’ N âˆ£ Î¼â€²
-----------------------------------------
  plug M F âˆ£ Î¼ âˆ£ pc â€”â†’ plug N F âˆ£ Î¼â€²


plug (blame p) F âˆ£ Î¼ âˆ£ pc â€”â†’ blame p âˆ£ Î¼


      (stamp pc â„“) âŸ¨ gâ‚ â‹Ìƒ â„“ â‡’ gâ‚‚ âŸ© âŸ¨ cÌ… âŸ© â€”â†  pcâ€²
-------------------------------------------------------- âŠ¢ pc : gâ‚  âŠ¢ cÌ… : gâ‚‚ â‡’ gâ‚ƒ
   { cÌ… } M âŸª â„“ âŸ« âˆ£ Î¼ âˆ£ pc â€”â†’ â¦ƒ pcâ€² â¦„ M âŸª â„“ âŸ« âˆ£ Î¼


      (stamp pc â„“) âŸ¨ gâ‚ â‹Ìƒ â„“ â‡’ gâ‚‚ âŸ© âŸ¨ cÌ… âŸ© â€”â†  pc_err p
-------------------------------------------------------- âŠ¢ pc : gâ‚  âŠ¢ cÌ… : gâ‚‚ â‡’ gâ‚ƒ
   { cÌ… } M âŸª â„“ âŸ« âˆ£ Î¼ âˆ£ pc â€”â†’ blame p


              M âˆ£ Î¼ âˆ£ pcâ€² â€”â†’ N âˆ£ Î¼â€²
------------------------------------------------------------
â¦ƒ pcâ€² â¦„ M âŸª â„“ âŸ« âˆ£ Î¼ âˆ£ pc  â€”â†’ â¦ƒ pcâ€² â¦„ N âŸª â„“ âŸ« âˆ£ Î¼â€²


â¦ƒ pcâ€² â¦„ blame p âŸª â„“ âŸ« âˆ£ Î¼ âˆ£ pc â€”â†’ blame p


â¦ƒ _ â¦„ V âŸª â„“ âŸ« âˆ£ Î¼ âˆ£ pc â€”â†’ stamp V â„“ âˆ£ Î¼


                 cÌ… â€”â†  cÌ…â‚™
-----------------------------------------------------
    Váµ£ âŸ¨ cáµ£ | cÌ… âŸ© âˆ£ Î¼ | pc â€”â†’ Váµ£ âŸ¨ cáµ£ | cÌ…â‚™ âŸ© âˆ£ Î¼


                 cÌ… â€”â†  âŠ¥áµ–
--------------------------------------------
    Váµ£ âŸ¨ cáµ£ | cÌ… âŸ© âˆ£ Î¼ | pc â€”â†’ blame p


k âŸ¨ id(Î¹) | id(â„“) âŸ© âˆ£ Î¼ âˆ£ pc â€”â†’ k âˆ£ Î¼


(Váµ£ âŸ¨ cáµ¢ âŸ©) âŸ¨ d âŸ© âˆ£ Î¼ âˆ£ pc â€”â†’ V âŸ¨ cáµ¢ â¨Ÿ d âŸ© âˆ£ Î¼


app (Æ› N) V A B â„“ âˆ£ Î¼ âˆ£ pc â€”â†’ â¦ƒ stamp pc â„“ â¦„ (N[ V ]) âŸª â„“ âŸ« âˆ£ Î¼


app! (Æ› N) V A B â„“ âˆ£ Î¼ âˆ£ pc â€”â†’ { id(â‹†) } (N[ V ]) âŸª â„“ âŸ« âˆ£ Î¼


app ((Æ› N) âŸ¨ dÌ… | c â†’ d | cÌ…â‚™ âŸ©) V A B â„“ âˆ£ Î¼ âˆ£ pc â€”â†’
     let V âŸ¨ c âŸ© in ({ dÌ… } (N âŸ¨ d âŸ©) âŸª âˆ¥ cÌ…â‚™ âˆ¥ âŸ«) âˆ£ Î¼


app! ((Æ› N) âŸ¨ dÌ… | c â†’ d | cÌ…â‚™ âŸ©) V A B g âˆ£ Î¼ âˆ£ pc â€”â†’
     let V âŸ¨ c âŸ© in ({ dÌ… } (N âŸ¨ d âŸ©) âŸª âˆ¥ cÌ…â‚™ âˆ¥ âŸ«) âˆ£ Î¼


if true A â„“ M N âˆ£ Î¼ âˆ£ pc â€”â†’ â¦ƒ stamp pc â„“ â¦„ M âŸª â„“ âŸ« âˆ£ Î¼


if! true A â„“ M N âˆ£ Î¼ âˆ£ pc â€”â†’ { id(â‹†) } M âŸª â„“ âŸ« âˆ£ Î¼


if (true âŸ¨ id(ğ”¹) | â†‘ âŸ©) A high M N âˆ£ Î¼ âˆ£ pc â€”â†’ â¦ƒ stamp pc high â¦„ M âŸª high âŸ« âˆ£ Î¼


if! (true âŸ¨ id(ğ”¹) | cÌ…â‚™ âŸ©) A g M N âˆ£ Î¼ âˆ£ pc â€”â†’ { id(â‹†) } M âŸª âˆ¥ cÌ…â‚™ âˆ¥ âŸ« âˆ£ Î¼


let V A N âˆ£ Î¼ âˆ£ pc â€”â†’ N[ V ] âˆ£ Î¼


refâŸ¦ â„“ âŸ§ V âˆ£ Î¼ âˆ£ pc â€”â†’ addr n â„“ âˆ£ Î¼(â„“ â†¦ Î¼(â„“)(n â†¦ V))   , n is fresh


                         pc âŸ¨ â„“ ?áµ– âŸ© â€”â†  pcâ€²
-----------------------------------------------------------------------------
  ref?âŸ¦ â„“ âŸ§ V p âˆ£ Î¼ âˆ£ pc â€”â†’ addr n â„“ âˆ£ Î¼(â„“ â†¦ Î¼(â„“)(n â†¦ V)) , n is fresh


                         pc âŸ¨ â„“ ?áµ– âŸ© â€”â†  pc_err p
----------------------------------------------------------------------------
                  ref?âŸ¦ â„“ âŸ§ V p âˆ£ Î¼ âˆ£ pc â€”â†’ blame p


                                Î¼(â„“Ì‚)(n) = V
----------------------------------------------------------------
  ! (addr n â„“Ì‚) (T of â„“Ì‚) â„“ âˆ£ Î¼ âˆ£ pc â€”â†’ â¦ƒ pc â¦„ V âŸª â„“ âŸ« âˆ£ Î¼


                                Î¼(â„“Ì‚)(n) = V
------------------------------------------------------------------------------------
! (addr n â„“Ì‚ âŸ¨ in: c; out: d | cÌ…â‚™ âŸ©) A g âˆ£ Î¼ âˆ£ pc â€”â†’ â¦ƒ pc â¦„ (V âŸ¨ d âŸ©) âŸª âˆ¥ cÌ…â‚™ âˆ¥ âŸ«


assign (addr n â„“Ì‚) V T â„“Ì‚ â„“ âˆ£ Î¼ âˆ£ pc â€”â†’ unit âˆ£ Î¼(â„“Ì‚ â†¦ Î¼(â„“Ì‚)(n â†¦ V))


------------------------------------------------------------------------
assign (addr n â„“Ì‚ âŸ¨ in: c; out: d | cÌ…â‚™ âŸ©) V T â„“Ì‚ â„“ âˆ£ Î¼ âˆ£ pc â€”â†’
       unit âˆ£ Î¼(â„“Ì‚ â†¦ Î¼(â„“Ì‚)(n â†¦ VâŸ¨câŸ©))


     (stamp pc âˆ¥ cÌ…â‚™ âˆ¥) âŸ¨ g â‹Ìƒ âˆ¥ cÌ…â‚™ âˆ¥ â‡’ â‹† âŸ© âŸ¨ â„“Ì‚ ?áµ– âŸ© â€”â†  pcâ€²
------------------------------------------------------------------------ âŠ¢ pc : g
assign? (addr n â„“Ì‚ âŸ¨ in: c; out: d | cÌ…â‚™ âŸ©) V T p âˆ£ Î¼ | pc â€”â†’
        unit | Î¼(â„“Ì‚ â†¦ Î¼(â„“Ì‚)(n â†¦ VâŸ¨câŸ©))


     (stamp pc âˆ¥ cÌ…â‚™ âˆ¥) âŸ¨ g â‹Ìƒ âˆ¥ cÌ…â‚™ âˆ¥ â‡’ â‹† âŸ© âŸ¨ â„“Ì‚ ?áµ– âŸ© â€”â†  pc_err p
------------------------------------------------------------------------ âŠ¢ pc : g
assign? (addr n â„“Ì‚ âŸ¨ in: c; out: d | cÌ…â‚™ âŸ©) V T p âˆ£ Î¼ | pc â€”â†’
        blame p
