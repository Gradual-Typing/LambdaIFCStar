todo: move all compilation-related code here
